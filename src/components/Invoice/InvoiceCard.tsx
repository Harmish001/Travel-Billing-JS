"use client";

import React from "react";
import {
	Card,
	Typography,
	Button,
	Space,
	Popconfirm,
	Tag,
	Tooltip,
	Row,
	Col
} from "antd";
import {
	EyeOutlined,
	DeleteOutlined,
	FilePdfOutlined,
	FileExcelOutlined
} from "@ant-design/icons";
import { IBillingResponse } from "@/src/types/iBilling";
import { useDeleteBilling } from "@/src/hooks/billingHook";
import { notification } from "antd";

const { Text, Title } = Typography;

interface InvoiceCardProps {
	invoice: IBillingResponse;
	onView: (invoice: IBillingResponse) => void;
	onExportPDF: (invoice: IBillingResponse) => void;
	onExportExcel: (invoice: IBillingResponse) => void;
}

const InvoiceCard: React.FC<InvoiceCardProps> = ({
	invoice,
	onView,
	onExportPDF,
	onExportExcel
}) => {
	const {
		mutate: deleteBilling,
		isPending: isDeleting,
	} = useDeleteBilling();
	const [api, contextHolder] = notification.useNotification();

	const handleDelete = () => {
		deleteBilling(invoice._id);
	};

	const handleView = () => {
		onView(invoice);
	};

	const handleExportPDFClick = () => {
		onExportPDF(invoice);
	};

	const handleExportExcelClick = () => {
		onExportExcel(invoice);
	};

	const formatDate = (dateString: string) => {
		return new Date(dateString).toLocaleDateString("en-US", {
			year: "numeric",
			month: "short",
			day: "numeric"
		});
	};

	const formatDateTime = (dateString: string) => {
		return new Date(dateString).toLocaleString("en-US", {
			year: "numeric",
			month: "short",
			day: "numeric",
			hour: "2-digit",
			minute: "2-digit"
		});
	};

	return (
		<>
			{contextHolder}
			<Card
				size="small"
				style={{ 
					height: "100%",
					borderRadius: "12px",
					boxShadow: "0 2px 8px rgba(0,0,0,0.1)"
				}}
				bodyStyle={{ padding: "16px" }}
				actions={[
					<Tooltip key="view" title="View Invoice">
						<Button
							type="text"
							icon={<EyeOutlined />}
							onClick={handleView}
							style={{ 
								border: "none",
								borderRadius: "20px",
								width: "100%",
								height: "40px"
							}}
						/>
					</Tooltip>,
					<Tooltip key="delete" title="Delete Invoice">
						<Popconfirm
							title="Delete Invoice"
							description="Are you sure you want to delete this invoice?"
							onConfirm={handleDelete}
							okText="Delete"
							cancelText="Cancel"
							okButtonProps={{ 
								danger: true, 
								loading: isDeleting,
								style: { borderRadius: "20px" }
							}}
							cancelButtonProps={{
								style: { borderRadius: "20px" }
							}}
							placement="topRight"
						>
							<Button
								type="text"
								icon={<DeleteOutlined />}
								danger
								style={{ 
									border: "none",
									borderRadius: "20px",
									width: "100%",
									height: "40px"
								}}
							/>
						</Popconfirm>
					</Tooltip>
				]}
			>
				<Space direction="vertical" style={{ width: "100%" }} size="middle">
					<div>
						<Title level={4} style={{ margin: 0, fontSize: "18px" }}>
							{invoice._id.substring(0, 8)}
						</Title>
						<Text type="secondary" style={{ fontSize: "13px" }}>
							{invoice.companyName}
						</Text>
					</div>

					<Row gutter={[8, 8]}>
						<Col span={12}>
							<Text strong style={{ fontSize: "12px" }}>Vehicles:</Text>
							<br />
							<Text style={{ fontSize: "13px" }}>
								{invoice.vehicleIds.map(v => v.vehicleNumber).join(", ")}
							</Text>
						</Col>
						<Col span={12}>
							<Text strong style={{ fontSize: "12px" }}>Recipient:</Text>
							<br />
							<Text style={{ fontSize: "13px" }}>{invoice.recipientName}</Text>
						</Col>
					</Row>

					<Row gutter={[8, 8]}>
						<Col span={12}>
							<Text strong style={{ fontSize: "12px" }}>Amount:</Text>
							<br />
							<Text strong style={{ fontSize: "14px", color: "#52c41a" }}>
								â‚¹{invoice.totalInvoiceValue?.toLocaleString("en-IN") || 0}
							</Text>
						</Col>
						<Col span={12}>
							<Text strong style={{ fontSize: "12px" }}>Created:</Text>
							<br />
							<Tooltip title={formatDateTime(invoice.createdAt.toString())}>
								<Text type="secondary" style={{ fontSize: "12px" }}>
									{formatDate(invoice.createdAt.toString())}
								</Text>
							</Tooltip>
						</Col>
					</Row>
				</Space>
			</Card>
		</>
	);
};

export default InvoiceCard;